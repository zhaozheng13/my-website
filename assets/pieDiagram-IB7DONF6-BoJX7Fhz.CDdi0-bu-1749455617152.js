import{p as t}from"./chunk-4BMEZGHF-Byc923bM.CdS2rBcE-1749455617152.js";import{a as e,v as a,r as n,w as i,x as r,M as l,L as o,l as s,g as p,W as c,a8 as d,aa as u,z as f,R as g,Y as h,ab as m,ac as x,ad as y}from"./index.Dw4ooDwm-1749455617152.js";import{p as S}from"./radar-MK3ICKWK-CiNWpY4n.DhpnLwA9-1749455617152.js";import{d as w}from"./arc-Bj1iKruZ.BAXR5aUr-1749455617152.js";import{o as C}from"./ordinal-DSZU4PqD.CpLirDK9-1749455617152.js";import"./_baseUniq-CyBKxUBB.CyZcTB1b-1749455617152.js";import"./min-DKZp8rBd.CfE8nV7X-1749455617152.js";import"./clone-CS7zTRQj.B-55aQLe-1749455617152.js";import"./init-ZxktEp_H.C0SZ43gy-1749455617152.js";function D(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function $(t){return t}var T=h.pie,v={sections:new Map,showData:!1},A=v.sections,b=v.showData,M=structuredClone(T),j={getConfig:e((()=>structuredClone(M)),"getConfig"),clear:e((()=>{A=new Map,b=v.showData,g()}),"clear"),setDiagramTitle:o,getDiagramTitle:l,setAccTitle:r,getAccTitle:i,setAccDescription:n,getAccDescription:a,addSection:e((({label:t,value:e})=>{A.has(t)||(A.set(t,e),s.debug(`added new section: ${t}, with value: ${e}`))}),"addSection"),getSections:e((()=>A),"getSections"),setShowData:e((t=>{b=t}),"setShowData"),getShowData:e((()=>b),"getShowData")},k=e(((e,a)=>{t(e,a),a.setShowData(e.showData),e.sections.map(a.addSection)}),"populateDb"),B={parse:e((async t=>{const e=await S("pie",t);s.debug(e),k(e,j)}),"parse")},z=e((t=>`\n  .pieCircle{\n    stroke: ${t.pieStrokeColor};\n    stroke-width : ${t.pieStrokeWidth};\n    opacity : ${t.pieOpacity};\n  }\n  .pieOuterCircle{\n    stroke: ${t.pieOuterStrokeColor};\n    stroke-width: ${t.pieOuterStrokeWidth};\n    fill: none;\n  }\n  .pieTitleText {\n    text-anchor: middle;\n    font-size: ${t.pieTitleTextSize};\n    fill: ${t.pieTitleTextColor};\n    font-family: ${t.fontFamily};\n  }\n  .slice {\n    font-family: ${t.fontFamily};\n    fill: ${t.pieSectionTextColor};\n    font-size:${t.pieSectionTextSize};\n    // fill: white;\n  }\n  .legend text {\n    fill: ${t.pieLegendTextColor};\n    font-family: ${t.fontFamily};\n    font-size: ${t.pieLegendTextSize};\n  }\n`),"getStyles"),R=e((t=>{const e=[...t.entries()].map((t=>({label:t[0],value:t[1]}))).sort(((t,e)=>e.value-t.value));return function(){var t=$,e=D,a=null,n=m(0),i=m(y),r=m(0);function l(l){var o,s,p,c,d,u=(l=x(l)).length,f=0,g=new Array(u),h=new Array(u),m=+n.apply(this,arguments),S=Math.min(y,Math.max(-y,i.apply(this,arguments)-m)),w=Math.min(Math.abs(S)/u,r.apply(this,arguments)),C=w*(S<0?-1:1);for(o=0;o<u;++o)(d=h[g[o]=o]=+t(l[o],o,l))>0&&(f+=d);for(null!=e?g.sort((function(t,a){return e(h[t],h[a])})):null!=a&&g.sort((function(t,e){return a(l[t],l[e])})),o=0,p=f?(S-u*C)/f:0;o<u;++o,m=c)s=g[o],c=m+((d=h[s])>0?d*p:0)+C,h[s]={data:l[s],index:o,value:d,startAngle:m,endAngle:c,padAngle:w};return h}return l.value=function(e){return arguments.length?(t="function"==typeof e?e:m(+e),l):t},l.sortValues=function(t){return arguments.length?(e=t,a=null,l):e},l.sort=function(t){return arguments.length?(a=t,e=null,l):a},l.startAngle=function(t){return arguments.length?(n="function"==typeof t?t:m(+t),l):n},l.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:m(+t),l):i},l.padAngle=function(t){return arguments.length?(r="function"==typeof t?t:m(+t),l):r},l}().value((t=>t.value))(e)}),"createPieArcs"),W={parser:B,db:j,renderer:{draw:e(((t,e,a,n)=>{s.debug("rendering pie chart\n"+t);const i=n.db,r=p(),l=c(i.getConfig(),r.pie),o=18,g=450,h=g,m=d(e),x=m.append("g");x.attr("transform","translate(225,225)");const{themeVariables:y}=r;let[S]=u(y.pieOuterStrokeWidth);S??(S=2);const D=l.textPosition,$=Math.min(h,g)/2-40,T=w().innerRadius(0).outerRadius($),v=w().innerRadius($*D).outerRadius($*D);x.append("circle").attr("cx",0).attr("cy",0).attr("r",$+S/2).attr("class","pieOuterCircle");const A=i.getSections(),b=R(A),M=[y.pie1,y.pie2,y.pie3,y.pie4,y.pie5,y.pie6,y.pie7,y.pie8,y.pie9,y.pie10,y.pie11,y.pie12],j=C(M);x.selectAll("mySlices").data(b).enter().append("path").attr("d",T).attr("fill",(t=>j(t.data.label))).attr("class","pieCircle");let k=0;A.forEach((t=>{k+=t})),x.selectAll("mySlices").data(b).enter().append("text").text((t=>(t.data.value/k*100).toFixed(0)+"%")).attr("transform",(t=>"translate("+v.centroid(t)+")")).style("text-anchor","middle").attr("class","slice"),x.append("text").text(i.getDiagramTitle()).attr("x",0).attr("y",-200).attr("class","pieTitleText");const B=x.selectAll(".legend").data(j.domain()).enter().append("g").attr("class","legend").attr("transform",((t,e)=>"translate(216,"+(22*e-22*j.domain().length/2)+")"));B.append("rect").attr("width",o).attr("height",o).style("fill",j).style("stroke",j),B.data(b).append("text").attr("x",22).attr("y",14).text((t=>{const{label:e,value:a}=t.data;return i.getShowData()?`${e} [${a}]`:e}));const z=512+Math.max(...B.selectAll("text").nodes().map((t=>(null==t?void 0:t.getBoundingClientRect().width)??0)));m.attr("viewBox",`0 0 ${z} 450`),f(m,g,z,l.useMaxWidth)}),"draw")},styles:z};export{W as diagram};
